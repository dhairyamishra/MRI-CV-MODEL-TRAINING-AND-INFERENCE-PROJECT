# ============================================================================
# Phase 2.2: Classification Head Training Configuration - QUICK TEST
# ============================================================================
# Train classification head with frozen encoder on Kaggle dataset
# This is Stage 2 of 3-stage multi-task training strategy
# QUICK TEST MODE: Full dataset, 3 epochs, ~5-10 minutes
# 
# IMPORTANT: PyTorch 2.6+ requires weights_only=False when loading checkpoints
# IMPORTANT: Windows requires num_workers=0 for DataLoader

# Experiment metadata
experiment:
  name: "multitask_cls_head_quick_test"
  description: "Phase 2.2 QUICK TEST - Classification head training for fast testing"
  tags: ["multitask", "classification", "cls_head", "kaggle", "quick_test"]
  notes: "Quick test with 3 epochs for rapid validation"

# Paths
paths:
  kaggle_train_dir: "data/processed/kaggle/train"
  kaggle_val_dir: "data/processed/kaggle/val"
  kaggle_test_dir: "data/processed/kaggle/test"
  brats_train_dir: "data/processed/brats2d_full/train"
  brats_val_dir: "data/processed/brats2d_full/val"
  brats_test_dir: "data/processed/brats2d_full/test"
  checkpoint_dir: "checkpoints/multitask_cls_head_quick_test"
  log_dir: "logs/multitask_cls_head_quick_test"
  output_dir: "outputs/multitask_cls_head_quick_test"

# Model architecture
model:
  name: "multitask"
  in_channels: 1          # Single-channel MRI
  out_channels: 1         # Binary segmentation
  seg_out_channels: 1     # Binary segmentation
  cls_num_classes: 2      # Tumor / No Tumor
  base_filters: 32        # Must match Stage 1
  depth: 4                # Must match Stage 1
  cls_hidden_dim: 128     # REDUCED from 256 for faster training
  cls_dropout: 0.5        # Classification head dropout

# Encoder initialization
encoder_init:
  path: "checkpoints/multitask_seg_warmup_quick_test/best_model.pth"
  freeze_encoder: true    # Freeze encoder during training
  freeze_seg_decoder: true # Freeze segmentation decoder

# Loss function
loss:
  name: "cross_entropy"   # Cross-entropy for classification
  # class_weights: null   # Commented out - will use unweighted loss (or specify weights like [0.4, 0.6])
  label_smoothing: 0.1    # Label smoothing for better generalization

# Optimizer (only for classification head parameters)
optimizer:
  name: "adamw"
  lr: 0.001               # Higher LR for classification head
  weight_decay: 0.0001
  betas: [0.9, 0.999]
  eps: 1.0e-8

# Learning rate scheduler
scheduler:
  name: "cosine"
  T_max: 3                # REDUCED to match epochs
  eta_min: 1.0e-6

# Training hyperparameters
training:
  epochs: 3               # REDUCED for quick test
  batch_size: 64          # INCREASED for faster iterations
  num_workers: 0
  pin_memory: true
  
  # Mixed precision training
  use_amp: true
  
  # Gradient clipping
  grad_clip: 1.0
  
  # Early stopping
  early_stopping:
    enabled: true
    patience: 10          # REDUCED patience
    min_delta: 0.001
    monitor: "val_acc"
    mode: "max"
  
  # Checkpoint saving
  save_best: true
  save_last: true
  save_frequency: 5
  keep_last_n: 5
  save_optimizer: true
  save_scheduler: true

# Data augmentation
augmentation:
  train:
    enabled: true
    random_flip_h: 0.5
    random_flip_v: 0.5
    random_rotate: 10     # REDUCED rotation
    random_scale: 0.08    # REDUCED scale
    gaussian_noise: 0.008 # REDUCED noise
    gaussian_blur: 0.15   # REDUCED blur
    brightness: 0.1       # REDUCED brightness
    contrast: 0.1         # REDUCED contrast
    gamma: 0.1            # REDUCED gamma
  val:
    enabled: false

# Weights & Biases logging
wandb:
  enabled: false          # DISABLED for quick test
  project: null
  entity: null
  name: null
  tags: null
  notes: null

# Reproducibility
seed: 42

# Device
device: "cuda"
